<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="board.mapper">

<update id="readcnt_es">
         update board set readcnt = readcnt + 1
      where no = #{no}
   </update>
	<delete id="board_clear_gw">
		delete from board
	</delete>
	
	<insert id="board_insert_gw">
		insert into board(EVENTNM, OPAR, EVENTCO, EVENTSTARTDATE, EVENTENDDATE, EVENTSTARTTIME, EVENTENDTIME, CHRGEINFO, MNNST, AUSPCINSTT, PHONENUMBER, SUPRTINSTT, SEATNUMBER, ADMFEE, ENTNCAGE, DSCNTINFO, ATPN, HOMEPAGEURL, ADVANTKINFO, PRKPLCEYN, RDNMADR, LNMADR, LATITUDE, LONGITUDE, REFERENCEDATE)
		values(#{eventNm}, #{opar}, #{eventCo}, #{eventStartDate}, #{eventEndDate}, #{eventStartTime}, #{eventEndTime}, #{chrgeInfo}, #{mnnst}, #{auspcInstt}, #{phoneNumber},
			   #{suprtInstt}, #{seatNumber}, #{admfee}, #{entncAge}, #{dscntInfo}, #{atpn}, #{homepageUrl}, #{advantkInfo}, #{prkplceYn}, #{rdnmadr}, #{lnmadr}, #{latitude}, #{longitude}, #{referenceDate} )
	</insert>
	
	<select id="board_list_gw" resultType="app_board.BoardVO">
		select *
		from (select rownum num, b.*, (select name from member where email = b.writer) name
			from (select * from board <include refid="where_search" />
					order by no) b
			order by num desc)
		where num between #{beginList} and #{endList}
	</select>
	
	<update id="board_read_gw">
	update board set readcnt = readcnt + 1
	where no = ${no}
	</update>
	
	<select id="board_detail" resultType="app_board.BoardVO">
		select * from board where no = ${id}
	</select>
	<select id="list_cnt_web_gw" resultType="Integer">
		select count(*) from board <include refid="where_search" />
	</select>
	
	<select id="all_gm" resultType="app_board.BoardVO">
		select * 
		from board
		order by eventnm
	</select>
	
	<select id="musical_gm" resultType="app_board.BoardVO">
		select * 
		from board
		where eventco like '%뮤지컬%'
		order by eventnm
	</select>

	<select id="opera_gm" resultType="app_board.BoardVO">
		select * 
		from board
		where eventco like '%오페라%'
		order by eventnm
	</select>
	
	<select id="play_gm" resultType="app_board.BoardVO">
		select * 
		from board
		where eventco like '%연극%'
		or eventco like '%공연%'
		or eventco like '%극%'
		or eventco like '%발레%'
		order by eventnm
	</select>
	
	<select id="exhibition_gm" resultType="app_board.BoardVO">
		select * 
		from board
		where eventco like '%전시회%'
		or eventco like '%기념%'
		or eventco like '%전%'
		or eventco like '%화%'
		or eventco like '%서예%'
		order by eventnm
	</select>
	
	<select id="concert_gm" resultType="app_board.BoardVO">
		select * 
		from board
		where eventco like '%음악회%'
		or eventco like '%음악%' 
		or eventco like '%음%'
		or eventco like  '%연주%'
		or eventco like  '%악%'
		or eventco like  '%가요%'
		or eventco like  '%클래식%'
		or eventco like  '%재즈%'
		order by eventnm
	</select>
<!--추천 탭에 목록 가져오는 애들  -->
	<!-- 조회순  -->
	<select id="read_es" resultType="app_board.BoardVO">
      select *
      from board 
      order by readcnt
   </select>
	<!--댓글순  -->   
   <select id="review_es" resultType="app_board.BoardVO">
      select b.*, (select content from comments where comments.writer = b.writer) content
      from board b
      order by content
   </select>
	<!--좋아요 순  -->   
   <select id="favorite_es" resultType="app_board.BoardVO">
      select b.*, (select like_type from favorite) like_type
      from board b
      order by like_type
   </select>
   
<!--검색을 위한 단축어  -->
   <sql id = 'where_search'>
	<if test="search=='eventnm' or search=='eventco' ">
		where ${search} like '%'|| #{keyword} || '%' 
	</if>
	<if test="search == 'writer' ">
		where <include refid="search_writer" />		
	</if>
	<if test="search == 'all' ">
		where eventnm like '%'|| #{keyword} ||'%'
		or eventco like '%'|| #{keyword} ||'%'
		or <include refid="search_writer" /> 
		<!--  writer in ( select id from s_member where name like '%'|| #{keyword} ||'%' ) -->
	</if>
</sql>
<sql id='search_writer'>
	writer in ( select email from member where name like '%'|| #{keyword} ||'%' )
</sql>
</mapper>